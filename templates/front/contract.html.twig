{% extends 'base.html.twig' %}

{% block title %}AMAP Pré-vert - Contrat{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('css/contract.css') }}">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
{% endblock %}

{% block body %}
	<div class="container">
		<header>
			<div class="row text-center">
				<div class="col-lg-12">
					<h2>Contrat {{ contract.name }}</h2>
				</div>
				<div class="col-lg-12 mt-5">
					{% if contract.imageName %}
						<img src="{{ vich_uploader_asset(contract, 'image_file') | imagine_filter('large') }}" alt="Image contrat {{ contract.name }}" id="contractImage">
					{% else %}
						<img src="{{ asset('images/vegetables_basket.jpg' | imagine_filter('large')) }}" alt="Panier de légumes" id="contractImage">
					{% endif %}
				</div>
			</div>
		</header>

		<section id="contractDescription">
			<div class="row">
				<div class="col">
					<p>Du {{ contract.startingSeasonAt|date("d/m/Y")}} au {{ contract.endingSeasonAt|date("d/m/Y")}}</p>
				</div>
			</div>
			<div class="row">
				<div class="col" id="description">
					<p>{{ contract.description|raw }}</p>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<h4>Liste des produits proposés:</h4>
					<table class="table table-responsive-sm">
						<thead>
							<tr class="table-info">
								<th>Nom</th>
								<th>Prix min</th>
								<th>Prix max</th>
								<th>Prix fixe</th>
							</tr>
						</thead>
						<tbody>
							{% for product in contract.products %}
								<tr>
									<td>{{ product.name }}</td>
									<td>{% if product.minPrice %} {{ product.minPrice }}€ {% else %} - {% endif %}</td>
									<td>{% if product.maxPrice %} {{ product.maxPrice }}€ {% else %} - {% endif %}</td>
									<td>{% if product.fixedPrice %} {{ product.fixedPrice }}€ {% else %} - {% endif %}</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</section>

		<section id="growerDataContainer">
			<div class="row">
				<div class="col-lg-12">
					<h4>Le producteur:</h4>
				</div>
				<div class="col-lg-6">
					<div id="map"></div>
				</div>
				<div class="col-lg-6">
					<div class="row justify-content-center text-center" id="growerData">
						<div class="col-lg-6 align-self-center">
							<h5>{{ contract.grower.name }}</h5>
							<p> {{ contract.grower.address }}<br>
								{{ contract.grower.postalCode }} {{ contract.grower.city }}</p>
							{% if contract.grower.phone %} <p><span class="fas fa-phone"></span> {{ contract.grower.phone }}</p> {% endif %}
							{% if contract.grower.email %} <p><span class="far fa-envelope"></span> {{ contract.grower.email }}</p> {% endif %}
							{% if contract.grower.website %} <p><span class="fas fa-mouse-pointer"></span> <a href="{{ contract.grower.website }}">Site Internet</a></p> {% endif %}
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>
{% endblock %}

{% block javascripts %}
	<script type="text/javascript">
		let latitude = {{ contract.grower.gpsLat }};
		let longitude = {{ contract.grower.gpsLng }};
		let markerTitle = "{{ contract.grower.name }}";
	</script>
	{% include 'map/openStreetMap.html.twig' %}
{% endblock %}